{% extends "base.html" %}
{% load staticfiles liked_user %}
{% block title %}
{% if user == request.user %}
Мои товары
{% else %}
Товары пользователя "{{ user.get_full_name }}"
{% endif %}
{% endblock %}
{% block content %}
<style>
.good_fullscreen{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 20;
  padding: 5%;
  display: block;
  overflow: auto;
}
.good_add_fullscreen{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 20;
  padding: 5%;
  display: block;
  overflow: auto;
}
#good_loader .card-body img{
  width: 100% !important;
  height: auto !important;
}
@media screen and (min-width: 621px){
.good_fullscreen {
  left: 20%;
  width: 60%;
  padding-left: 5%;
  padding-right: 5%;
}
.good_add_fullscreen {
  left: 20%;
  width: 60%;
  padding-left: 5%;
  padding-right: 5%;
}
}
.good_fullscreen_hide{
  cursor:pointer;
  float: right;
  margin-top: 12px;
}
.next_item{
  position: absolute;
  left: -10%;
  top: 120px;
  cursor:pointer;
}
.prev_item{
  position: absolute;
  right: -10%;
  top: 120px;
  cursor:pointer;
}

.good_fullscreen_hide{
  cursor:pointer;
  float: right;
  margin-top: 12px;
}
.load{
  display:none;
}
</style>

<div class="container-fluid bg-light-opac">
            <div class="row">
                <div class="container my-3 main-container">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <button id="good_add" class="btn btn-rounded text-uppercase">
                              <img style="width:22px" src="{% static 'images/icons/add-24px.svg' %}" />
                              <span class="text-hide-xs">Создать товар</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<div class="container mt-4 main-container">
            <div class="row goods_stream infinite-container">
              {% if object_list %}
              {% for object in object_list %}
                <div class="col-12 col-md-4 infinite-item">
                    <div class="card mb-4">
                        <div class="card-body pb-0">
                            <div class="row align-items-center no-gutters">
                                <div class="col">
                                        <div>
                                            <div class="swiper-wrapper">
                                                <div class="swiper-slide text-center">
                                                  {% if object.image %}
                                                  <img style="width:100%" src="{{ object.image.url }}" alt="">
                                                  {% else %}
                                                  <img style="width:100%" src="{% static 'images/no-image.jpg' %}" />
                                                  {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                </div>
                            </div>
                            <h5 style="cursor:pointer" data-action="good_detail" data-id="{{ object.id }}" class="card-title mb-1 header-color-primary text-center">{{ object.title }}</h5>
                            <h6 class="card-subtitle mb-2 header-color-secondary text-center">{{ object.sub_category }}</h6>
                            <br>
                            <div class="row bg-light-secondary text-center">
                                <div class="col py-3">
                                    <h5 class="content-color-primary mb-0">{{ object.price }}</h5>
                                    <p class="content-color-secondary small mb-0">Цена</p>
                                </div>
                                <div class="col py-3">
                                    <h5 class="content-color-primary mb-0">{{ object.views }}</h5>
                                    <p class="content-color-secondary small mb-0">{{ object.views|rupluralize:"просмотр,просмотра,просмотров" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <div class="load col-12 col-md-12" >
                  {% if page_obj.has_next %}
                    <a style="display:flex;justify-content:center;" class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">
                      <img src="{% static 'images/loading.gif' %}">
                    </a>
                  {% endif %}

                </div>
                {% else %}
                <h6>  Пока ничего нет...</h6>
                {% endif %}
            </div>
</div>

<div class="card mb-4 good_add_fullscreen" style="display:none">
  <div id="good_add_loader" style="margin-top:30px"></div>
</div>

<div class="card mb-4 good_fullscreen" style="display:none">
  <div id="good_loader" style=""></div>
</div>

<script>
	$( "#good_add" ).click(function(){
		$('#good_add_loader').html('').load("/goods/add/");
		$('.good_add_fullscreen').show();
	})
</script>

<script src="{% static 'scripts/jquery.waypoints.min.js' %}" type="text/javascript"></script>
<script src="{% static 'scripts/infinite.min.js' %}" type="text/javascript"></script>
<script>
    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],
        onBeforePageLoad: function() {
            $('.load').show();
        },
        onAfterPageLoad: function($items) {
            $('.load').hide();
        }
    });
</script>
<script>
  function good_detail() {
     var good = $(this);
     var good_id = good.data("id");
     console.log(good,good_id);
     $('#good_loader').html('').load("/goods/detail/" + good_id)
     $('.good_fullscreen').show();
  };
  $('[data-action="good_detail"]').click(good_detail);
  </script>
{% endblock %}
