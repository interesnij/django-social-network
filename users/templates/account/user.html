{% extends "base.html" %}
{% load staticfiles humanize %}

{% block title %}{{ user.get_full_name }}{% endblock %}
{% block meta %}
<meta property="og:url" content="dvizhenie.tv" />
<meta property="og:type" content="website" />
<meta property="og:title" content="" />
<meta property="og:image" content="{% if user.profile.avatar %}http://xn--b1afgj5al1e.xn--p1acf/{{ user.profile.avatar }}{% else %}{% static 'images/user.png' %}{% endif %}"/>
{% endblock %}
{% block content %}

<div class="row user_page">
    <div class="col-lg-4 col-md-5 col-sm-12 order-1">

        {% include 'profile/card_profile.html' %}

        {% include 'profile/common_frends.html' %}

        {% include 'profile/online_frends.html' %}

        {% include 'profile/frends.html' %}

        {% include 'profile/communities.html' %}

        {% include 'profile/gallery.html' %}

    </div>
    <div class="col-lg-8 col-md-7 col-sm-12 order-2 ">
        <div class="card mb-4" style="padding:10px">
            <h3 class="mb-0">{{ user.get_full_name }}</h3>
            {% if user.get_online %}
              <i class="text-success">Онлайн</i>
            {% else %}
              <i style="color:#888888">Был(а) {{ user.last_activity|naturaltime }}</i>
            {% endif %}
            <br><br>
        </div>

          <div id="stat_load"></div>

          <div id="lenta_load"></div>

        </div>
    </div>

<script>
$(document).ready(function(){
	$('#lenta_load').html('').load("/users/detail/list/" + {{ user.pk }});
	$('#button_load').html('').load("/users/load/profile_button/" + {{ user.pk }});
	$('#stat_load').html('').load("/users/load/profile_stat/" + {{ user.pk }});
});
</script>
<script>
$('.user_page').on('click', '.avatar_detail', function() {
		var photo = $(this);
		var photo_id = photo.data("id");
		var user_uuid = photo.data("uuid");
		$('#photo_loader').html('').load("/gallery/load/avatar_detail/" + photo_id + "/" + user_uuid + "/")
		$('.photo_fullscreen').show();
});
function new_message_popap(new_message) {
	if ($(".wrapper").length == 0){
		$(new_message).wrapInner("<div class='wrapper'></div>");
	}
	$(new_message).show();
	$(new_message).click(function(e) {
		if ( e.target == this ) {
			if ($(new_message).is(':visible')) {
				$(new_message).hide();
			}
		}
	});
	$(new_message).find("button[name=message_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(new_message).hide();
	});
}
$(document).ready(function () {
	$("[data-js=new_message]").on("click", function() {
		new_message_popap($(".new_message"));
	});
});

	var lenta = new Waypoint.Infinite({
	    element: $('.lenta-container')[0], onBeforePageLoad: function() { $('.items-load').show(); }, onAfterPageLoad: function($items) { $('.items-load').hide(); }
	});
</script>
<div class="card mb-4 article_fullscreen" style="display:none">
    <span class="article_fullscreen_hide">
        <img style="width:35px" src="{% static 'images/icons/close-24px.svg' %}" />
    </span>
    <div id="article_loader" style="margin-top:30px"></div>
</div>
<div class="card mb-4 photo_fullscreen" style="display:none">
    <span class="photo_fullscreen_hide">
        <img style="width:35px" src="{% static 'images/icons/close-24px.svg' %}" />
    </span>
    <div id="photo_loader" style="margin-top:30px;position:relative;"></div>
</div>
{% endblock %}
