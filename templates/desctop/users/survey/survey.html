{% load user %}

<div class="card" style="flex: 0 0 100%;">

  <div class="mb-3 border text-center has-background-img position-relative box-shadow" style="padding: 2rem 1rem;border-radius: .3rem;">

      <figure class="background-img">
        {% if object.image %}
          <img src="{{ object.image.url }}" alt="user image">
        {% endif %}
      </figure>

      <div class="dropdown">
          <a class="btn_default drop pointer" style="position:absolute;right:-5px;top:-20px;">
              <svg class="svg_info" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M0 0h24v24H0z" fill="none" />
                  <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
              </svg>
          </a>
          <div class="dropdown-menu dropdown-menu-right" data-pk="{{ object.pk }}" data-type="sur{{ object.pk }}" style="top:6px;right:-10px;">
            <span class="dropdown-item create_repost">Добавить</span>
            {% if not object.is_no_edited and object|is_user_voted:request.user.pk %}
              <span class="dropdown-item survey_unvote">Удалить голос</span>
            {% endif %}
            {% if object|is_user_can_edit_delete:request.user %}
              <span class="dropdown-item survey_edit">Изменить</span>
              <span class="dropdown-item survey_remove">Удалить</span>
            {% elif request.user.is_moderator %}
              <span class="dropdown-item create_close">Закрыть</span>
            {% else %}
              <span class="dropdown-item create_claim">Пожаловаться</span>
            {% endif %}
            <span class="dropdown-item copy_link">Копировать ссылку</span>
          </div>
      </div>

      <form>
        {% csrf_token %}
      <div class="container answers_container">
        <br>
        <h4>{{ object.title }}</h4>
        <p class="position-relative">
          <a href="{% url 'user' pk=object.creator.pk %}" class="underline ajax">
            {{ object.creator }}
          </a>
        </p>
        {% if object.time_end %}
          <p class="content-color-primary">До {{ object.time_end }}</p>
        {% endif %}
        <br>

        {% for answer in object.get_answers %}

          {% if object|is_user_voted:request.user.pk %}
          <div class="lite_color answer_style">
            <div class="progress2" style="width:{{ answer.get_procent }}%;"></div>
            <span class="progress_span_r">{{ answer.text }}</span>
            <span class="progress_span_l" style="margin-left: auto;">
              <span class="vote_svg">
                <svg fill="currentColor" style="width:15px;height:15px;" class="svg_default" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"></path><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"></path></svg>
              </span>
              {{ answer.get_count }}
            </span>
          </div>

          {% elif object.is_time_end %}
          <div class="lite_color answer_style">
            <div class="progress2" style="width:{{ answer.get_procent }}%;"></div>
            <span class="progress_span_r">{{ answer.text }}</span>
            <span class="progress_span_l" style="margin-left: auto;">
              {{ answer.get_count }}
            </span>
          </div>

          {% else %}
          <div class="lite_color pointer answer_style survey_vote {{ object.is_multiple }}" data-pk="{{ answer.pk }}">
            <div class="progress2" style="width:{{ answer.get_procent }}%;"></div>
            <span class="progress_span_r">{{ answer.text }}</span>
            <span class="progress_span_l" style="margin-left: auto;">
              <span class="vote_svg"></span>
              {{ answer.get_count }}
            </span>
          </div>

          {% endif %}
        {% endfor %}
        {% if object.is_have_votes %}
          {{ object.get_users }}
        {% else %}
          Пока никто не голосовал.
        {% endif %}
      </div>
      <div class="card-footer" style="position: relative;">
          <button class="btn hidden btn-sm float-left border votes_remove">Отмена</button>
          <button id="add_vote_survey_btn" data-pk="{{ object.pk }}" type="button" class="btn hidden btn-sm btn-success float-right">Проголосовать</button>
      </div>
      </form>
  </div>
</div>
