!function(e){function a(t,e){void 0===e&&n(t)&&(e=t,t=void 0),t=$(t),this.options=o.extend({},a.defaults,e||{}),this.data={},void 0!==t&&this.loadElement(t),this.loadData(),this.loader=new a.Loader($(this.data.target)),this.execute()}if("jQuery"in e){function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function r(t){return i(t)?0===t.length:!t}var o=e.jQuery,n=function(t){return o.isPlainObject(t)};a.VERSION="1.0.1",a.defaults={url_attribute:["data-href","href"],replace_attribute:"data-replace",replace:!0,element_attribute:["data-el","#ajax"],element:"html",target_attribute:["data-target","#ajax"],target:"html"},a.prototype.loadElement=function(t){var e={url:this.getValueByAttr(t,this.options.url_attribute),element:this.getValueByAttr(t,this.options.element_attribute),target:this.getValueByAttr(t,this.options.target_attribute),replace:this.getValueByAttr(t,this.options.replace_attribute)};for(var a in e)r(e[a])||(this.data[a]=e[a])},a.prototype.loadData=function(){var t={url:this.options.url,element:this.options.element,target:this.options.target,replace:this.options.replace};for(var e in t)r(t[e])||e in this.data||(this.data[e]=t[e])},a.prototype.getValueByAttr=function(t,e){i(e)||(e=[e]);for(var a=0;a<e.length;a++){var r=t.attr(e[a]);if(void 0!==r&&!1!==r)return r}},a.prototype.execute=function(){var e=this;e.loader.update(100,500),o.ajax({sync:!1,type:"GET",url:this.data.url,success:function(t){e.loader.update(100,300,function(){e.render(t),e.updateUrl(),document.title=$(t).filter("title").text()})},error:function(){e.loader.error(2e3,function(){e.execute()})}})},a.prototype.updateUrl=function(){if(!0===this.data.replace)try{e.history.pushState({path:e.location.href},"",this.data.url)}catch(t){console.error("history.pushState failed, maybe HTML5 is not supported?"),console.error(t.stack),e.location.replace(this.data.url)}},a.prototype.render=function(t){"html"!==this.data.element&&(t=$(t).find(this.data.element).html()),"html"!==this.data.target?$(this.data.target).html(t):(document.open(),document.write(t),document.close())},(a.PercentLoader=function(t){this.target=t,this.backdrop=$('<div class="ajax-backdrop"></div>'),this.bar=$('<div class="ajax-bar"></div>'),this.err=$('<div class="ajax-backdrop-error"></div>'),this.abort=!1,this.init()}).prototype.init=function(){var t=this;this.target.css("position","relative"),this.backdrop.appendTo(this.target),this.bar.width(0),this.bar.appendTo(this.backdrop),this.err.appendTo(this.backdrop),$(document).on("click",".ajax-backdrop",function(){$(this).remove(),t.abort=!0,$(document).off("click",".ajax-backdrop")})},a.PercentLoader.prototype.update=function(t,e,a){this.bar.stop().animate({width:t+"%"},e,"linear",function(){void 0!==a&&a()})},a.PercentLoader.prototype.error=function(t,e){var a=this;this.bar.stop(),this.bar.width(0),this.bar.addClass("ajax-bar-error"),this.err.text("Error occurred, retrying. Click anywhere to exit."),this.bar.animate({width:"100%"},t,"linear",function(){a.bar.width(0),a.bar.removeClass("ajax-bar-error"),void 0!==e&&!1===a.abort&&e()})},a.Loader=a.PercentLoader,o.fn.ajax=function(e){return $(document).on("click",this.selector,function(t){new a(this,e),t.preventDefault()}),this},$(e).bind("popstate",function(t){var e=t.originalEvent.state;e&&new a({url:e.path,replace:!1})}),history.replaceState({path:e.location.href},""),e.Ajax=a}else console.error("Ajax's JavaScript requires jQuery.")}(window),$(".ajax").ajax();
